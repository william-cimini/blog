<!DOCTYPE html>
<html>
<head>
  <meta content="text/html; charset=utf-8" http-equiv="content-type">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>William Cimini's Blog</title>
  <link href='normalize.css' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
</head>
<body>
  <header>
    <nav>
        <a href="/">williamcimini.com</a>
    </nav>
  </header>
<main>
<h1 id="generating-random-users-for-an-active-directory-lab">Generating random users for an Active Directory lab</h1>
<h2 id="cause">Cause</h2>
<p>There is not much point to an Active Directory lab without a realistic set of users and processes.</p>
<p>Key tasks for an Active Directory lab could include the following:</p>
<ul>
<li>Bulk importing users</li>
<li>Creating users with a set of realistic properties that would reflect a real hire.</li>
</ul>
<h2 id="solution">Solution</h2>
<p><a href="https://randomuser.me/">https://randomuser.me/</a> offers a random user generation API which is interactable with PowerShell.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="fu">Invoke-RestMethod</span> <span class="st">&quot;https://randomuser.me/api/&quot;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>results</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="op">-------</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span>@<span class="op">{</span>gender<span class="op">=</span>female<span class="op">;</span> name<span class="op">=;</span> location<span class="op">=;</span> email<span class="op">=</span>gilberte<span class="op">.</span><span class="fu">riviere</span>@example<span class="op">.</span><span class="fu">com</span><span class="op">;</span> login<span class="op">=;</span> dob<span class="op">=;</span> registered<span class="op">=;</span> phone<span class="op">=</span>078 569 28 06<span class="op">;</span> cell<span class="op">=</span>075 8<span class="op">...</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$RandomUser</span> <span class="op">=</span> <span class="fu">Invoke-RestMethod</span> <span class="st">&quot;https://randomuser.me/api/&quot;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$RandomUser</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>results</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="op">-------</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="op">{</span>@<span class="op">{</span>gender<span class="op">=</span>male<span class="op">;</span> name<span class="op">=;</span> location<span class="op">=;</span> email<span class="op">=</span>albert<span class="op">.</span><span class="fu">walker</span>@example<span class="op">.</span><span class="fu">com</span><span class="op">;</span> login<span class="op">=;</span> dob<span class="op">=;</span> registered<span class="op">=;</span> phone<span class="op">=(</span>536<span class="op">)-</span>330<span class="op">-</span>1596<span class="op">;</span> cell<span class="op">=(</span>368<span class="op">)-</span>087<span class="op">...</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">Results</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>gender     <span class="op">:</span> male</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>name       <span class="op">:</span> @<span class="op">{</span>title<span class="op">=</span>Mr<span class="op">;</span> first<span class="op">=</span>Albert<span class="op">;</span> last<span class="op">=</span>Walker<span class="op">}</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>location   <span class="op">:</span> @<span class="op">{</span>street<span class="op">=;</span> city<span class="op">=</span>Overland Park<span class="op">;</span> state<span class="op">=</span>West Virginia<span class="op">;</span> country<span class="op">=</span>United States<span class="op">;</span> postcode<span class="op">=</span>60882<span class="op">;</span> coordinates<span class="op">=;</span> timezone<span class="op">=}</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>email      <span class="op">:</span> albert<span class="op">.</span><span class="fu">walker</span>@example<span class="op">.</span><span class="fu">com</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>login      <span class="op">:</span> @<span class="op">{</span>uuid<span class="op">=</span>0e51aaf9<span class="op">-</span>b054<span class="op">-</span>4511<span class="op">-</span>a8ab<span class="op">-</span>5f7a85956028<span class="op">;</span> username<span class="op">=</span>purplepanda400<span class="op">;</span> password<span class="op">=</span>lorenzo<span class="op">;</span> salt<span class="op">=</span>Qawsufg4<span class="op">;</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>             md5<span class="op">=</span>703db485d427a0df5815ef886f982068<span class="op">;</span> sha1<span class="op">=</span>1ce74a0952db3535de1ac23ea9d9b4cd28dfbf98<span class="op">;</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>             sha256<span class="op">=</span>9614f73ca823e4465fe79f15081e8ef3303c9f2c13dce1dcce822628ccb72de4<span class="op">}</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>dob        <span class="op">:</span> @<span class="op">{</span>date<span class="op">=</span>1995<span class="op">-</span>09<span class="op">-</span>30T02<span class="op">:</span>49<span class="op">:</span>47<span class="op">.</span><span class="fu">631Z</span><span class="op">;</span> age<span class="op">=</span>26<span class="op">}</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>registered <span class="op">:</span> @<span class="op">{</span>date<span class="op">=</span>2010<span class="op">-</span>07<span class="op">-</span>31T21<span class="op">:</span>07<span class="op">:</span>11<span class="op">.</span><span class="fu">924Z</span><span class="op">;</span> age<span class="op">=</span>11<span class="op">}</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>phone      <span class="op">:</span> <span class="op">(</span>536<span class="op">)-</span>330<span class="op">-</span>1596</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>cell       <span class="op">:</span> <span class="op">(</span>368<span class="op">)-</span>087<span class="op">-</span>8150</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>id         <span class="op">:</span> @<span class="op">{</span>name<span class="op">=</span>SSN<span class="op">;</span> value<span class="op">=</span>289<span class="op">-</span>92<span class="op">-</span>7444<span class="op">}</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>picture    <span class="op">:</span> @<span class="op">{</span>large<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>men<span class="op">/</span>66<span class="op">.</span><span class="fu">jpg</span><span class="op">;</span> medium<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>med<span class="op">/</span>men<span class="op">/</span>66<span class="op">.</span><span class="fu">jpg</span><span class="op">;</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>             thumbnail<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>thumb<span class="op">/</span>men<span class="op">/</span>66<span class="op">.</span><span class="fu">jpg</span><span class="op">}</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>nat        <span class="op">:</span> US</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">Results</span><span class="op">.</span><span class="fu">Name</span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>title first  last</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="op">-----</span> <span class="op">-----</span>  <span class="op">----</span></span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>Mr    Albert Walker</span></code></pre></div>
<p>The API offers a result count parameter which allows the generation of multiple users with one request.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$Count</span> <span class="op">=</span> 3</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$Request</span> <span class="op">=</span> <span class="fu">Invoke-RestMethod</span> <span class="st">&quot;https://randomuser.me/api/?results=$Count&quot;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="va">$Request</span><span class="op">.</span><span class="fu">Results</span><span class="op">.</span><span class="fu">Name</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>title first  last</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="op">-----</span> <span class="op">-----</span>  <span class="op">----</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>Mr    Adem   Beşok</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>Mrs   Joske  Ten Hoopen</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>Mr    Arnold Diaz</span></code></pre></div>
<p>A function can be created which handles all the implementation details.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Get<span class="op">-</span>RandomUser <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">param</span><span class="op">(</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span>ValidateRange<span class="op">(</span>1<span class="op">,</span>5000<span class="op">)]</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">[</span><span class="dt">int</span><span class="op">]</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>        <span class="va">$Count</span> <span class="op">=</span> 1</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Invoke-RestMethod</span> <span class="st">&quot;https://randomuser.me/api/?results=$Count&quot;</span> <span class="op">|</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Select-Object</span> <span class="op">-</span>Expand Results</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> Get<span class="op">-</span>RandomUser</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>gender     <span class="op">:</span> female</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>name       <span class="op">:</span> @<span class="op">{</span>title<span class="op">=</span>Miss<span class="op">;</span> first<span class="op">=</span>Amanda<span class="op">;</span> last<span class="op">=</span>Makela<span class="op">}</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>location   <span class="op">:</span> @<span class="op">{</span>street<span class="op">=;</span> city<span class="op">=</span>Isojoki<span class="op">;</span> state<span class="op">=</span>Satakunta<span class="op">;</span> country<span class="op">=</span>Finland<span class="op">;</span> postcode<span class="op">=</span>28070<span class="op">;</span> coordinates<span class="op">=;</span> timezone<span class="op">=}</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>email      <span class="op">:</span> amanda<span class="op">.</span><span class="fu">makela</span>@example<span class="op">.</span><span class="fu">com</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>login      <span class="op">:</span> @<span class="op">{</span>uuid<span class="op">=</span>182a882a<span class="op">-</span>3cd9<span class="op">-</span>4b3c<span class="op">-</span>a4b0<span class="op">-</span>9927cc426741<span class="op">;</span> username<span class="op">=</span>beautifullion635<span class="op">;</span> password<span class="op">=</span>quasar<span class="op">;</span> salt<span class="op">=</span>X1IQoW4q<span class="op">;</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>             md5<span class="op">=</span>f5bb45f2d50f34d78a8cab2cf2e8cb63<span class="op">;</span> sha1<span class="op">=</span>53d62bbface1d580ec69ed5f0d53c56438930c7b<span class="op">;</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>             sha256<span class="op">=</span>084fbd104867f53ef648eece706cd074a9dbe1576068c04656d6e1aea67bcf0f<span class="op">}</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>dob        <span class="op">:</span> @<span class="op">{</span>date<span class="op">=</span>1952<span class="op">-</span>10<span class="op">-</span>10T03<span class="op">:</span>23<span class="op">:</span>12<span class="op">.</span><span class="fu">575Z</span><span class="op">;</span> age<span class="op">=</span>69<span class="op">}</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>registered <span class="op">:</span> @<span class="op">{</span>date<span class="op">=</span>2010<span class="op">-</span>10<span class="op">-</span>05T14<span class="op">:</span>28<span class="op">:</span>28<span class="op">.</span><span class="fu">881Z</span><span class="op">;</span> age<span class="op">=</span>11<span class="op">}</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>phone      <span class="op">:</span> 08<span class="op">-</span>213<span class="op">-</span>420</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>cell       <span class="op">:</span> 040<span class="op">-</span>283<span class="op">-</span>28<span class="op">-</span>78</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>id         <span class="op">:</span> @<span class="op">{</span>name<span class="op">=</span>HETU<span class="op">;</span> value<span class="op">=</span>NaNNA580undefined<span class="op">}</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>picture    <span class="op">:</span> @<span class="op">{</span>large<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>women<span class="op">/</span>73<span class="op">.</span><span class="fu">jpg</span><span class="op">;</span> medium<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>med<span class="op">/</span>women<span class="op">/</span>73<span class="op">.</span><span class="fu">jpg</span><span class="op">;</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>             thumbnail<span class="op">=</span>https<span class="op">://</span>randomuser<span class="op">.</span><span class="fu">me</span><span class="op">/</span>api<span class="op">/</span>portraits<span class="op">/</span>thumb<span class="op">/</span>women<span class="op">/</span>73<span class="op">.</span><span class="fu">jpg</span><span class="op">}</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>nat        <span class="op">:</span> FI</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">PS</span> C<span class="op">:</span>\Users\williamc<span class="op">&gt;</span> <span class="op">(</span>Get<span class="op">-</span>RandomUser <span class="op">-</span>Count 3<span class="op">).</span><span class="fu">Name</span></span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>title first    last</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a><span class="op">-----</span> <span class="op">-----</span>    <span class="op">----</span></span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>Miss  Susie    Burns</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>Mr    Eli      Robinson</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a>Mr    Lindomar Trouw</span></code></pre></div>
<h2 id="one-thing-to-note">One thing to note</h2>
<p>The API can be adapted for Active Directory account creation. It is common for the API generate the same user however. Using the <a href=".\duplicate-samaccountnames-and-distinguishednames.html">duplicate SamAccountName and DistinguishedName functions from the last article</a> the errors can be avoided.</p>
<h2 id="implementation">Implementation</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode powershell"><code class="sourceCode powershell"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">function</span> Import<span class="op">-</span>RandomUserToAD <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">param</span><span class="op">(</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="va">$RandomUser</span><span class="op">,</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="va">$TargetDN</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">$ValidSamAccountName</span> <span class="op">=</span> Get<span class="op">-</span>ValidSamAccountName <span class="op">-</span>GivenName <span class="op">(</span><span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">first</span> <span class="op">-</span>replace <span class="st">&quot;\W&quot;</span><span class="op">,</span><span class="st">&quot;&quot;</span><span class="op">)</span> <span class="op">-</span>Surname <span class="op">(</span><span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">last</span> <span class="op">-</span>replace <span class="st">&quot;\W&quot;</span><span class="op">,</span><span class="st">&quot;&quot;</span><span class="op">)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">$ValidContainerName</span> <span class="op">=</span> Get<span class="op">-</span>ValidContainerName <span class="op">-</span>GivenName <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">first</span> <span class="op">-</span>Surname <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">last</span> <span class="op">-</span>ParentContainer <span class="va">$TargetDN</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">try</span> <span class="op">{</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">if</span> <span class="op">(!</span><span class="va">$ValidSamAccountName</span> <span class="op">-</span>or <span class="op">!</span><span class="va">$ValidContainerName</span><span class="op">)</span> <span class="op">{</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>            <span class="kw">throw</span> <span class="st">&quot;SamAccountName or Container Name possibilites exhausted per duplicate name policy.&quot;</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">$NewADUserParams</span> <span class="op">=</span> @<span class="op">{</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>            SamAccountName <span class="op">=</span> <span class="va">$ValidSamAccountName</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>            Path <span class="op">=</span> <span class="va">$TargetDN</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>            GivenName <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">first</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>            SurName <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">name</span><span class="op">.</span><span class="fu">last</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>            Name <span class="op">=</span> <span class="va">$ValidContainerName</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>            DisplayName <span class="op">=</span> <span class="st">&quot;$($RandomUser.name.first) $($RandomUser.name.last)&quot;</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>            EmailAddress <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">email</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>            HomePhone <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">phone</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>            MobilePhone <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">cell</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>            StreetAddress <span class="op">=</span> <span class="st">&quot;$($RandomUser.location.street.number) $($RandomUser.location.street.name)&quot;</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>            City <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">location</span><span class="op">.</span><span class="fu">city</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>            State <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">location</span><span class="op">.</span><span class="fu">state</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>            Country <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">nat</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>            PostalCode <span class="op">=</span> <span class="va">$RandomUser</span><span class="op">.</span><span class="fu">location</span><span class="op">.</span><span class="fu">postcode</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a>        <span class="fu">New-ADUser</span> @NewADUserParams</span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Write-Host</span> <span class="st">&quot;Created user $($randomuser.name.first) $($randomuser.name.last).</span><span class="ch">`t</span><span class="st">ValidSamAccountName: $ValidSamAccountName</span><span class="ch">`t</span><span class="st">| ValidContainerName: $ValidContainerName</span><span class="ch">`t</span><span class="st">| TargetDN: $TargetDN&quot;</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> <span class="kw">catch</span> <span class="op">{</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">Write-Host</span> <span class="st">&quot;Failed to create user $($randomuser.name.first) $($randomuser.name.last): $($error[0])</span><span class="ch">`t</span><span class="st">ValidSamAccountName: $ValidSamAccountName</span><span class="ch">`t</span><span class="st">| ValidContainerName: $ValidContainerName</span><span class="ch">`t</span><span class="st">| TargetDN: $TargetDN&quot;</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h2 id="usage">Usage</h2>
<pre><code>PS C:\Windows\system32&gt; $TargetDN = &quot;OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com&quot;
PS C:\Windows\system32&gt; $RandomUsers = Get-RandomUser 10
PS C:\Windows\system32&gt; foreach ($RandomUser in $RandomUsers) {
    Import-RandomUserToAD -RandomUser $RandomUser -TargetDN $TargetDN
}

Created user Isabelle Martin.   ValidSamAccountName: IMartin    | ValidContainerName: Isabelle Martin   | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Koray Bolatlı. ValidSamAccountName: KBolatlı   | ValidContainerName: Koray Bolatlı | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Pilar Ruiz.    ValidSamAccountName: PRuiz  | ValidContainerName: Pilar Ruiz    | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Hannah Kowalski.   ValidSamAccountName: HKowalski  | ValidContainerName: Hannah Kowalski   | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user پرنیا نكو نظر. ValidSamAccountName: پرنكونظر   | ValidContainerName: پرنیا نكو نظر | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Siril Hammeren.    ValidSamAccountName: SHammeren  | ValidContainerName: Siril Hammeren    | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Frederick Carter.  ValidSamAccountName: FCarter    | ValidContainerName: Frederick Carter  | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Eugenio Vega.  ValidSamAccountName: EVega  | ValidContainerName: Eugenio Vega  | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Gül Önür.  ValidSamAccountName: GÖnür  | ValidContainerName: Gül Önür  | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com
Created user Angelina Fonnes.   ValidSamAccountName: AFonnes    | ValidContainerName: Angelina Fonnes   | TargetDN: OU=Users,OU=Company,DC=lab,DC=williamcimini,DC=com</code></pre>
<h2 id="output-sample">Output sample</h2>
<p>Currently User UPN Logon is missing, this will be fixed in a later update.</p>
<figure>
<img src=".\attachments\Untitled.png" title="Sample" alt="Sample user" /><figcaption aria-hidden="true">Sample user</figcaption>
</figure>
</body>
</html>